import { isWeb } from 'universal-env';
import { createMemoryHistory, createHashHistory, createBrowserHistory } from 'history';
import createApp from './common/createApp';

const INITIAL_DATA_FROM_SSR = '__INITIAL_DATA__';
const initialDataFromSSR = global[INITIAL_DATA_FROM_SSR];

let history;

export function getHistory() {
  return history;
}

function runApp(staticConfig, dynamicConfig) {
  // Set history
  if (typeof staticConfig.history !== 'undefined') {
    history = staticConfig.history;
  } else if (initialDataFromSSR) {
    // If that contains `initialDataFromSSR`, which means SSR is enabled,
    // we should use browser history to make it works.
    history = createBrowserHistory();
  } else if (isWeb) {
    history = createHashHistory();
  } else {
    // In other situation use memory history.
    history = createMemoryHistory();
  }

  createApp(staticConfig, dynamicConfig, {
    history
  });
}

export default runApp;

